{{- if not .Values.jwt.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "oryxid.jwt.secretName" . }}
  labels:
    {{- include "oryxid.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-weight": "-5"
type: Opaque
data:
  # JWT keys will be generated by init container or pre-install hook
  # Leave empty - keys are generated during deployment
  {{- if .Values.jwt.privateKey }}
  private-key: {{ .Values.jwt.privateKey | b64enc }}
  {{- end }}
  {{- if .Values.jwt.publicKey }}
  public-key: {{ .Values.jwt.publicKey | b64enc }}
  {{- end }}
{{- end }}
---
{{- if and (not .Values.admin.existingSecret) .Values.admin.password }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "oryxid.admin.secretName" . }}
  labels:
    {{- include "oryxid.labels" . | nindent 4 }}
type: Opaque
data:
  admin-password: {{ .Values.admin.password | b64enc }}
{{- end }}
---
{{- if and (not .Values.postgresql.enabled) (not .Values.externalDatabase.existingSecret) .Values.externalDatabase.password }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "oryxid.fullname" . }}-external-db
  labels:
    {{- include "oryxid.labels" . | nindent 4 }}
type: Opaque
data:
  password: {{ .Values.externalDatabase.password | b64enc }}
{{- end }}
---
{{- if and (not .Values.redis.enabled) (not .Values.externalRedis.existingSecret) .Values.externalRedis.password }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "oryxid.fullname" . }}-external-redis
  labels:
    {{- include "oryxid.labels" . | nindent 4 }}
type: Opaque
data:
  password: {{ .Values.externalRedis.password | b64enc }}
{{- end }}
